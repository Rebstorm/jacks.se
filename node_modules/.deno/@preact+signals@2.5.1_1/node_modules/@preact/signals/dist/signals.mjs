import{Component as t,options as i,isValidElement as n,Fragment as e}from"preact";import{useMemo as o,useState as f,useRef as r,useEffect as u}from"preact/hooks";import{effect as s,Signal as c,computed as l,signal as a,batch as d}from"@preact/signals-core";export{Signal,batch,computed,effect,signal,untracked}from"@preact/signals-core";const h="undefined"!=typeof window&&!!window.__PREACT_SIGNALS_DEVTOOLS__;let p,m,v,w=[],_=[];s(function(){p=this.N})();function g(t,n){i[t]=n.bind(null,i[t]||(()=>{}))}function y(t){if(v)v();v=t&&t.S()}function b({data:t}){const i=useSignal(t);i.value=t;const[e,f]=o(()=>{let t=this,e=this.__v;while(e=e.__)if(e.__c){e.__c.__$f|=4;break}const o=l(()=>{let t=i.value.value;return 0===t?0:!0===t?"":t||""}),f=l(()=>!Array.isArray(o.value)&&!n(o.value)),r=s(function(){this.N=M;if(f.value){const i=o.value;if(t.__v&&t.__v.__e&&3===t.__v.__e.nodeType)t.__v.__e.data=i}}),u=this.__$u.d;this.__$u.d=function(){r();u.call(this)};return[f,o]},[]);return e.value?f.peek():f.value}b.displayName="ReactiveTextNode";Object.defineProperties(c.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:b},props:{configurable:!0,get(){return{data:this}}},__b:{configurable:!0,value:1}});g("__b",(t,i)=>{if(h&&"function"==typeof i.type)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();if("string"==typeof i.type){let t,n=i.props;for(let e in n){if("children"===e)continue;let o=n[e];if(o instanceof c){if(!t)i.__np=t={};t[e]=o;n[e]=o.peek()}}}t(i)});g("__r",(t,i)=>{if(h&&"function"==typeof i.type)window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(i);if(i.type!==e){y();let t,n=i.__c;if(n){n.__$f&=-2;t=n.__$u;if(void 0===t)n.__$u=t=function(t){let i;s(function(){i=this});i.c=()=>{n.__$f|=1;n.setState({})};return i}()}m=n;y(t)}t(i)});g("__e",(t,i,n,e)=>{if(h)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();y();m=void 0;t(i,n,e)});g("diffed",(t,i)=>{if(h&&"function"==typeof i.type)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();y();m=void 0;let n;if("string"==typeof i.type&&(n=i.__e)){let t=i.__np,e=i.props;if(t){let i=n.U;if(i)for(let n in i){let e=i[n];if(void 0!==e&&!(n in t)){e.d();i[n]=void 0}}else{i={};n.U=i}for(let o in t){let f=i[o],r=t[o];if(void 0===f){f=k(n,o,r,e);i[o]=f}else f.o(r,e)}}}t(i)});function k(t,i,n,e){const o=i in t&&void 0===t.ownerSVGElement,f=a(n);return{o:(t,i)=>{f.value=t;e=i},d:s(function(){this.N=M;const n=f.value.value;if(e[i]!==n){e[i]=n;if(o)t[i]=n;else if(null!=n&&(!1!==n||"-"===i[4]))t.setAttribute(i,n);else t.removeAttribute(i)}})}}g("unmount",(t,i)=>{if("string"==typeof i.type){let t=i.__e;if(t){const i=t.U;if(i){t.U=void 0;for(let t in i){let n=i[t];if(n)n.d()}}}}else{let t=i.__c;if(t){const i=t.__$u;if(i){t.__$u=void 0;i.d()}}}t(i)});g("__h",(t,i,n,e)=>{if(e<3||9===e)i.__$f|=2;t(i,n,e)});t.prototype.shouldComponentUpdate=function(t,i){const n=this.__$u,e=n&&void 0!==n.s;for(let t in i)return!0;if(this.__f||"boolean"==typeof this.u&&!0===this.u){const t=2&this.__$f;if(!(e||t||4&this.__$f))return!0;if(1&this.__$f)return!0}else{if(!(e||4&this.__$f))return!0;if(3&this.__$f)return!0}for(let i in t)if("__source"!==i&&t[i]!==this.props[i])return!0;for(let i in this.props)if(!(i in t))return!0;return!1};function useSignal(t,i){return f(()=>a(t,i))[0]}function useComputed(t,i){const n=r(t);n.current=t;m.__$f|=4;return o(()=>l(()=>n.current(),i),[])}const q="undefined"==typeof requestAnimationFrame?setTimeout:function(t){const i=()=>{clearTimeout(n);cancelAnimationFrame(e);t()},n=setTimeout(i,35),e=requestAnimationFrame(i)},A=t=>{queueMicrotask(()=>{queueMicrotask(t)})};function T(){d(()=>{let t;while(t=w.shift())p.call(t)})}function x(){if(1===w.push(this))(i.requestAnimationFrame||q)(T)}function F(){d(()=>{let t;while(t=_.shift())p.call(t)})}function M(){if(1===_.push(this))(i.requestAnimationFrame||A)(F)}function useSignalEffect(t,i){const n=r(t);n.current=t;u(()=>s(function(){this.N=x;return n.current()},i),[])}export{useComputed,useSignal,useSignalEffect};//# sourceMappingURL=signals.mjs.map
